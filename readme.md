# 个人账单
根据需求，以下是微信小程序消费账单的非代码设计方案，分为功能模块、交互逻辑和存储方案三部分：

### 一、功能模块设计
#### 1. 账单管理模块
- **核心功能**：
  - 新增账单（带表单验证）
  - 列表展示（分页加载）
  - 编辑修改
  - 删除确认
- **交互元素**：
  - 悬浮按钮（新增）
  - 卡片式列表（日期+分类+金额）
  - 滑动删除操作
  - 搜索栏（日期/分类/备注）

#### 2. 统计展示模块
- **当月统计**：
  - 环形图（支出类型分布）
  - 收支总览（收入/支出对比）
  - Top5消费记录
- **年度统计**：
  - 折线图（每月收支趋势）
  - 柱状图（各月支出对比）
  - 年份选择器

#### 3. 数据管理模块
- **本地存储**：
  - 自动同步（增删改操作后）
  - 异常处理（存储失败提示）
- **文件备份**：
  - 手动导出/导入
  - 备份文件命名规则（billbackup_YYYYMMDD）
  - 备份记录管理

### 二、交互流程图
#### 1. 账单操作流程
```
用户入口
  ├─ [点击+] → 表单填写 → 验证 → 保存 → 返回列表
  ├─ [长按条目] → 弹出菜单（编辑/删除）
  ├─ [左滑] → 删除确认 → 执行删除
  └─ [点击条目] → 详情页 → 显示完整信息
```

#### 2. 统计查看流程
```
统计入口
  ├─ 默认显示当月数据
  ├─ [切换Tab] → 当月统计/年度统计
  ├─ [点击图表区域] → 显示具体数值
  └─ [下拉选择] → 切换年份/月份
```

#### 3. 数据备份流程
```
设置入口
  ├─ 导出 → 选择路径 → 生成加密JSON → 保存成功提示
  ├─ 导入 → 文件选择 → 数据合并 → 冲突处理（时间戳覆盖）
  └─ 存储状态 → 显示本地/备份数据量
```

### 三、存储方案设计
#### 1. 数据结构
```javascript
{
  "bills": [
    {
      "id": "1689321600000_001", // 时间戳+序列号
      "date": "2023-07-15",
      "type": "餐饮",
      "amount": -38.5,
      "remark": "午餐外卖"
    }
  ],
  "meta": {
    "lastSync": "2023-07-20T14:30:00",
    "backupVersion": 3
  }
}
```

#### 2. 存储策略
- **双写机制**：
  1. 优先写入内存缓存
  2. 同步写入wxStorage
  3. 异步备份到文件系统
- **冲突解决**：
  - 根据id进行覆盖更新
  - 保留最后修改时间戳
- **容量控制**：
  - 自动清理超过1年的数据
  - 单个备份文件不超过500KB

#### 3. 异常处理
- 存储失败时保留草稿
- 数据不一致时提示恢复备份
- 文件读写失败时重试机制

### 四、关键交互细节
1. **表单验证规则**：
   - 日期选择器限制未来日期
   - 金额输入强制两位小数
   - 分类选择预设+自定义

2. **数据可视化**：
   - 图表颜色按类型固定
   - 点击图表显示具体数值
   - 支持横屏查看细节

3. **性能优化**：
   - 分页加载（每次20条）
   - 本地数据索引（按日期建立Map）
   - 统计结果缓存机制

### 五、安全方案
1. 备份文件加密存储
2. 敏感操作需验证身份
3. 数据导出时脱敏处理
4. 本地存储上限预警
